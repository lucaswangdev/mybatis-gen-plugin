---
allwaysApply: true
---

# AI 单元测试规则

## 概述

本文档定义了AI在处理单元测试相关任务时必须遵循的标准规则。**所有单元测试相关任务必须按照此规则进行，确保测试覆盖完整、测试质量达标、测试执行可靠。**

## 1. 单元测试总则

AI在处理任何单元测试相关任务时，必须严格按照以下原则执行：

### 1.1 测试覆盖原则
- **核心功能测试**：所有核心业务逻辑必须有单元测试覆盖
- **边界条件测试**：包含正常输入、异常输入、边界值等场景
- **错误处理测试**：验证异常抛出和错误处理逻辑
- **集成点测试**：测试与其他组件的交互接口

### 1.2 测试质量标准
- **可读性**：测试代码应清晰表达测试意图
- **独立性**：每个测试用例应独立运行，不依赖其他测试
- **确定性**：测试结果应稳定、可预测
- **维护性**：测试代码应易于理解和修改

### 1.3 测试命名规范
- **方法命名**：test + 被测方法名 + 测试场景描述
- **类命名**：被测类名 + Test
- **描述清晰**：测试方法名应准确描述测试内容

## 2. 测试流程规范

### 2.1 测试编写阶段
1. **分析被测代码**：理解代码功能和依赖关系
2. **确定测试场景**：识别所有需要测试的路径
3. **编写测试用例**：使用Given-When-Then模式
4. **准备测试数据**：创建合适的测试数据和Mock对象

### 2.2 测试执行阶段
1. **运行测试**：确保所有测试通过
2. **分析覆盖率**：检查代码覆盖率是否达标
3. **性能验证**：确保测试执行时间合理
4. **持续集成**：集成到CI/CD流程中

### 2.3 测试维护阶段
1. **重构测试**：随代码重构更新测试
2. **清理冗余**：移除不再需要的测试
3. **优化性能**：改进测试执行效率

## 3. 特殊场景处理

### 3.1 数据库相关测试
- 使用内存数据库或Mock框架
- 避免依赖外部数据库状态
- 清理测试数据，确保测试隔离

### 3.2 文件操作测试
- 使用临时文件和目录
- 验证文件内容和权限
- 清理测试文件，避免残留

### 3.3 网络调用测试
- 使用Mock或Stub替代真实网络调用
- 模拟各种网络状态（正常、超时、错误）
- 验证请求和响应格式

### 3.4 多线程测试
- 测试并发访问的安全性
- 验证同步机制的有效性
- 避免竞态条件和死锁

## 4. 测试工具使用

### 4.1 JUnit框架
- 使用JUnit 4/5特性编写测试
- 合理使用@Test、@Before、@After等注解
- 利用断言方法验证结果

### 4.2 Mock框架
- 使用Mockito进行对象Mock
- 模拟依赖行为和返回值
- 验证方法调用次数和参数

### 4.3 覆盖率工具
- 使用JaCoCo生成覆盖率报告
- 确保核心代码覆盖率≥80%
- 识别未覆盖的代码分支

## 5. 测试验证标准

### 5.1 成功标准
- 所有测试用例通过
- 代码覆盖率达标
- 测试执行时间<5分钟
- 无内存泄漏或资源泄漏

### 5.2 质量检查
- 通过静态代码分析
- 遵循编码规范
- 文档更新同步
- 同行评审通过